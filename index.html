<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì§€ì§„ ë°ì´í„° ì‹œê°í™” (ê°€ìš´ë° ì •ë ¬)</title>

  <!-- Vega ë¼ì´ë¸ŒëŸ¬ë¦¬ -->
  <script src="https://cdn.jsdelivr.net/npm/vega@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    /* 1) ë¸Œë¼ìš°ì € í™”ë©´ ì „ì²´ë¥¼ Flex ì»¨í…Œì´ë„ˆë¡œ ì„¤ì • */
    html, body {
      margin: 0;
      padding: 0;
      height: 100vh;          /* ë·°í¬íŠ¸ ì „ì²´ ë†’ì´ë¥¼ 100%ë¡œ */
      display: flex;
      flex-direction: column; /* ìœ„ì—ì„œ ì•„ë˜ë¡œ ìŒ“ê¸° */
      align-items: center;    /* ê°€ë¡œ ì¶•(ìˆ˜í‰) ê°€ìš´ë° ì •ë ¬ */
      justify-content: center; /* ì„¸ë¡œ ì¶•ì—ì„œë„ ê°€ìš´ë° ì •ë ¬(í•„ìš” ì‹œ) */
      background-color: #eef2f5;
    }

    /* 2) Vega ì°¨íŠ¸(#vis)ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆì— ê³ ì • ë„ˆë¹„ì™€ ìë™ ì—¬ë°± ì§€ì • */
    #vis {
      width: 900px;
      height: 550px;
      margin: 0 auto;      /* ì¢Œìš° ìë™ ì—¬ë°± â†’ ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      background: white;   /* ì•½ê°„ì˜ í…Œë‘ë¦¬ ëŒ€ë¹„ë¥¼ ìœ„í•´ ë°°ê²½ìƒ‰ ì§€ì • */
    }

    /* 3) ì…ë ¥ ì»¨íŠ¸ë¡¤(controls) ì „ì²´ë¥¼ ê°€ë¡œ ë„ˆë¹„ 900pxë¡œ ë§ì¶”ê³ , ì¤‘ì•™ ì •ë ¬ */
    .controls {
      width: 900px;
      margin: 20px auto;   /* ìœ„ì•„ë˜ 20px, ì¢Œìš° ì¤‘ì•™ ì •ë ¬ */
      display: flex;
      flex-wrap: wrap;     /* ì¤„ ë°”ê¿ˆ í—ˆìš© */
      gap: 12px;           /* ì•„ì´í…œ ê°„ ê°„ê²© */
      background: white;
      padding: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 4px;
    }

    .controls > * {
      flex-shrink: 0;      /* ë‚´ìš© í¬ê¸°ê°€ ì§€ì •í•œ ë§Œí¼ ìœ ì§€ */
    }

    .controls label {
      font-size: 14px;
      margin-right: 6px;
      white-space: nowrap; /* ë ˆì´ë¸”ì´ ì¤„ ë°”ë€Œì§€ ì•Šë„ë¡ */
    }

    .controls input[type="text"] {
      width: 180px;
      padding: 4px 6px;
      font-size: 14px;
    }

    .controls input[type="range"] {
      width: 150px;
    }

    .controls input[type="date"] {
      padding: 4px;
    }
  </style>
</head>

<body>
  <!-- Vega ì°¨íŠ¸ë¥¼ ë Œë”ë§í•  ì˜ì—­ -->
  <div id="vis"></div>

  <!-- ê²€ìƒ‰ì°½, ìŠ¬ë¼ì´ë”, ë‚ ì§œ ì…ë ¥ ë“±ì„ ëª¨ì•„ë†“ì€ ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ -->
  <div class="controls">
    <div>
      <label for="searchTerm">ìœ„ì¹˜ ê²€ìƒ‰</label>
      <input type="text" id="searchTerm" placeholder="ì˜ˆ: ì¼ë³¸" />
    </div>

    <div>
      <label for="minMag">ìµœì†Œ ê·œëª¨</label>
      <input type="range" id="minMag" min="0" max="10" step="0.1" value="0" />
      <span id="minMagValue">0</span>
    </div>

    <div>
      <label for="maxMag">ìµœëŒ€ ê·œëª¨</label>
      <input type="range" id="maxMag" min="0" max="10" step="0.1" value="10" />
      <span id="maxMagValue">10</span>
    </div>

    <div>
      <label for="startDate">ì‹œì‘ ë‚ ì§œ</label>
      <input type="date" id="startDate" />
    </div>

    <div>
      <label for="endDate">ì¢…ë£Œ ë‚ ì§œ</label>
      <input type="date" id="endDate" />
    </div>
  </div>

  <script>
    // 1) Vega ìŠ¤í™ ì •ì˜
    const spec = {
      "$schema": "https://vega.github.io/schema/vega/v6.json",
      "width": 900,
      "height": 550,
      "padding": 5,
      "background": "steelblue",
      "signals": [
        {
          "name": "searchTerm",
          "value": "",
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "searchTerm" },
              "update": "searchTerm"
            }
          ]
        },
        {
          "name": "minMag",
          "value": 0,
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "minMag" },
              "update": "minMag"
            }
          ]
        },
        {
          "name": "maxMag",
          "value": 10,
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "maxMag" },
              "update": "maxMag"
            }
          ]
        },
        {
          "name": "startDate",
          "value": "",
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "startDate" },
              "update": "startDate"
            }
          ]
        },
        {
          "name": "endDate",
          "value": "",
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "endDate" },
              "update": "endDate"
            }
          ]
        }
      ],
      "projections": [
        {
          "name": "world_projection",
          "type": "equalEarth",
          "scale": 180,
          "translate": [
            { "signal": "width / 2" },
            { "signal": "height / 2" }
          ]
        }
      ],
      "data": [
        {
          "name": "world",
          "url": "https://vega.github.io/vega/data/world-110m.json",
          "format": { "type": "topojson", "feature": "countries" }
        },
        {
          "name": "earthquakes",
          "url": "https://raw.githubusercontent.com/Rhamee/Information-Visualization-Final/main/earthquake_data.json",
          "format": { "type": "json" },
          "transform": [
            {
              "type": "filter",
              "expr":
                "(searchTerm == '' || indexof(lower(datum.location), lower(searchTerm)) >= 0)" +
                " && (datum.magnitude >= minMag && datum.magnitude <= maxMag)" +
                " && (startDate == '' || datum.date >= startDate)" +
                " && (endDate == '' || datum.date <= endDate)"
            },
            {
              "type": "geopoint",
              "projection": "world_projection",
              "fields": ["longitude", "latitude"],
              "as": ["x", "y"]
            },
            {
              "type": "formula",
              "expr": "pow(datum.magnitude, 3.5)",
              "as": "area"
            }
          ]
        }
      ],
      "marks": [
        {
          "type": "shape",
          "from": { "data": "world" },
          "encode": {
            "enter": {
              "fill": { "value": "seagreen" },
              "stroke": { "value": "#666" }
            }
          },
          "transform": [
            {
              "type": "geoshape",
              "projection": "world_projection"
            }
          ]
        },
        {
          "type": "symbol",
          "from": { "data": "earthquakes" },
          "encode": {
            "enter": {
              "x": { "field": "x" },
              "y": { "field": "y" },
              "size": { "field": "area" },
              "fill": { "value": "orange" },
              "stroke": { "value": "orange" },
              "strokeWidth": { "value": 1 },
              "opacity": { "value": 0.6 },
              "tooltip": {
                "signal":
                  "'ğŸ“ ' + datum.location + '\\nê·œëª¨: ' + datum.magnitude + ' / ' + datum.date"
              }
            }
          }
        }
      ]
    };

    // 2) Vega-Embed (actions: falseë¡œ â€œexportâ€ ë²„íŠ¼ ë“±ì„ ìˆ¨ê¹€)
    vegaEmbed('#vis', spec, { actions: false }).then(({ view }) => {
      // 3) HTML ì»¨íŠ¸ë¡¤ì„ Vega ì‹œê·¸ë„ì— ì—°ê²°
      const searchEl   = document.getElementById('searchTerm');
      const minMagEl   = document.getElementById('minMag');
      const maxMagEl   = document.getElementById('maxMag');
      const startDateEl= document.getElementById('startDate');
      const endDateEl  = document.getElementById('endDate');
      const minValSpan = document.getElementById('minMagValue');
      const maxValSpan = document.getElementById('maxMagValue');

      // ìœ„ì¹˜ ê²€ìƒ‰ (í…ìŠ¤íŠ¸ ì…ë ¥)
      searchEl.addEventListener('input', () => {
        view.signal('searchTerm', searchEl.value).runAsync();
      });

      // ìµœì†Œ ê·œëª¨ ìŠ¬ë¼ì´ë”
      minMagEl.addEventListener('input', () => {
        minValSpan.textContent = minMagEl.value;
        view.signal('minMag', +minMagEl.value).runAsync();
      });

      // ìµœëŒ€ ê·œëª¨ ìŠ¬ë¼ì´ë”
      maxMagEl.addEventListener('input', () => {
        maxValSpan.textContent = maxMagEl.value;
        view.signal('maxMag', +maxMagEl.value).runAsync();
      });

      // ì‹œì‘ ë‚ ì§œ ì…ë ¥
      startDateEl.addEventListener('input', () => {
        view.signal('startDate', startDateEl.value).runAsync();
      });

      // ì¢…ë£Œ ë‚ ì§œ ì…ë ¥
      endDateEl.addEventListener('input', () => {
        view.signal('endDate', endDateEl.value).runAsync();
      });
    });
  </script>
</body>
</html>
