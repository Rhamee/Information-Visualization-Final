<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì§€ì§„ ë°ì´í„° ì‹œê°í™” (ê²€ìƒ‰/í•„í„° + ì¤Œ/íŒ¬)</title>

  <!-- Vega ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
  <script src="https://cdn.jsdelivr.net/npm/vega@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    /* ================================================
       1) í™”ë©´ ì „ì²´ë¥¼ Flex ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ì–´ ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬
       ================================================ */
    html, body {
      margin: 0;
      padding: 0;
      background-color: #eef2f5;
      display: flex;
      flex-direction: column;
      align-items: center;      /* ê°€ë¡œ ì¤‘ì•™ ì •ë ¬ */
      /* justify-content: center; ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ì´ í•„ìš”í•˜ë‹¤ë©´ í™œì„±í™” */
      min-height: 100vh;         /* ì„¸ë¡œë¡œë„ ì¶©ë¶„í•œ ê³µê°„ í™•ë³´ */
    }

    /* ================================================
       2) ì§€ë„ì™€ ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ë¥¼ ë¬¶ëŠ” ë˜í¼(wrapper)
       ================================================ */
    .wrapper {
      width: 900px;             /* ì§€ë„ì˜ ë„ˆë¹„ì™€ ì¼ì¹˜ì‹œí‚´ */
      margin: 20px auto;        /* í™”ë©´ ìƒí•˜ 20px, ì¢Œìš° ìë™(ê°€ìš´ë°) */
      display: flex;
      flex-direction: column;   /* ìœ„: ì§€ë„, ì•„ë˜: ì»¨íŠ¸ë¡¤ */
      align-items: stretch;     /* ìì‹ ìš”ì†Œê°€ ë„ˆë¹„ 100% (900px)ë¡œ ëŠ˜ì–´ë‚¨ */
      gap: 16px;                /* ì§€ë„ ì•„ë˜ì™€ ì»¨íŠ¸ë¡¤ ìœ„ ì‚¬ì´ 16px */
    }

    /* ================================================
       3) Vega ì‹œê°í™” ì˜ì—­ (#vis)
       ================================================ */
    #vis {
      width: 100%;              /* ë˜í¼ ë„ˆë¹„(900px)ì— ë”± ë§ì¶¤ */
      height: 550px;            /* ë†’ì´ ê³ ì • */
      background: white;        /* ë°°ê²½ í°ìƒ‰ */
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* ================================================
       4) ê²€ìƒ‰/í•„í„° ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ (.controls)
       ================================================ */
    .controls {
      width: 100%;             /* ë˜í¼ ë„ˆë¹„(900px)ì— ì¼ì¹˜ */
      background: white;
      display: flex;
      flex-wrap: wrap;         /* ë¶€ì¡±í•œ ê³µê°„ì€ ë‹¤ìŒ ì¤„ë¡œ ì´ë™ */
      gap: 12px;               /* ìš”ì†Œ ê°„ ê°„ê²© */
      padding: 12px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 4px;
    }

    .controls > div {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .controls label {
      font-size: 14px;
      white-space: nowrap;     /* ì¤„ ë°”ê¿ˆ ë°©ì§€ */
    }

    .controls input[type="text"] {
      width: 180px;
      padding: 4px 6px;
      font-size: 14px;
    }

    .controls input[type="range"] {
      width: 150px;
    }

    .controls input[type="date"] {
      padding: 4px;
      font-size: 14px;
    }

    .controls span {
      font-size: 14px;
      min-width: 24px;
      text-align: center;
    }
  </style>
</head>

<body>
  <!-- ================================================
       2) ë˜í¼(wrapper): ì§€ë„(#vis) + ì»¨íŠ¸ë¡¤(.controls) ëª¨ë‘ ì´ ì•ˆì— ìœ„ì¹˜
       ================================================ -->
  <div class="wrapper">
    <!-- 3) Vegaê°€ ë Œë”ë§í•  ì§€ë„ ê³µê°„ -->
    <div id="vis"></div>

    <!-- 4) ê²€ìƒ‰ì°½, ìŠ¬ë¼ì´ë”, ë‚ ì§œ ì…ë ¥ ë“±ì„ ë‹´ì€ ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ -->
    <div class="controls">
      <div>
        <label for="searchTerm">ìœ„ì¹˜ ê²€ìƒ‰</label>
        <input type="text" id="searchTerm" placeholder="ì˜ˆ: ì¼ë³¸" />
      </div>
      <div>
        <label for="minMag">ìµœì†Œ ê·œëª¨</label>
        <input type="range" id="minMag" min="0" max="10" step="0.1" value="0" />
        <span id="minMagValue">0</span>
      </div>
      <div>
        <label for="maxMag">ìµœëŒ€ ê·œëª¨</label>
        <input type="range" id="maxMag" min="0" max="10" step="0.1" value="10" />
        <span id="maxMagValue">10</span>
      </div>
      <div>
        <label for="startDate">ì‹œì‘ ë‚ ì§œ</label>
        <input type="date" id="startDate" />
      </div>
      <div>
        <label for="endDate">ì¢…ë£Œ ë‚ ì§œ</label>
        <input type="date" id="endDate" />
      </div>
    </div>
  </div>

  <script>
    // ===================================================================
    // Vega ìŠ¤í™: ê²€ìƒ‰/í•„í„°(Signals) + ì¤Œ/íŒ¬(Signals) + ë°ì´í„°/ë§ˆí¬ ì„¤ì •
    // ===================================================================
    const spec = {
      "$schema": "https://vega.github.io/schema/vega/v6.json",

      "width": 900,
      "height": 550,
      "padding": 0,
      "background": "steelblue",

      "signals": [
        // 1) ìœ„ì¹˜ ê²€ìƒ‰
        {
          "name": "searchTerm",
          "value": "",
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "searchTerm" },
              "update": "searchTerm"
            }
          ]
        },
        // 2) ìµœì†Œ/ìµœëŒ€ ê·œëª¨ ìŠ¬ë¼ì´ë”
        {
          "name": "minMag",
          "value": 0,
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "minMag" },
              "update": "minMag"
            }
          ]
        },
        {
          "name": "maxMag",
          "value": 10,
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "maxMag" },
              "update": "maxMag"
            }
          ]
        },
        // 3) ë‚ ì§œ ë²”ìœ„ í•„í„°
        {
          "name": "startDate",
          "value": "",
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "startDate" },
              "update": "startDate"
            }
          ]
        },
        {
          "name": "endDate",
          "value": "",
          "on": [
            {
              "events": { "source": "view", "type": "signal", "signal": "endDate" },
              "update": "endDate"
            }
          ]
        },
        // 4) ì¤Œ ë ˆë²¨ (íœ  ì´ë²¤íŠ¸)
        {
          "name": "zoom",
          "value": 180,
          "on": [
            {
              // window ì „ì²´ì—ì„œ íœ  ì´ë²¤íŠ¸ê°€ ë°œìƒí•˜ë©´ zoom ì—…ë°ì´íŠ¸
              "events": "window:wheel!",
              // event.deltaY ê°’ì´ ì–‘ìˆ˜ë©´ ì¶•ì†Œ, ìŒìˆ˜ë©´ í™•ëŒ€
              "update": "clamp(zoom * pow(1.001, -event.deltaY), 50, 1200)"
            }
          ]
        },
        // 5) íŒ¬(pan)ì„ ìœ„í•œ translate X
        {
          "name": "tx",
          "value": 450,   // ì´ˆê¸°ê°’: width/2
          "on": [
            {
              // window ì „ì²´ì—ì„œ ë“œë˜ê·¸ ì‹œ(Shift í‚¤ ë¯¸ì‚¬ìš©)
              "events": "window:drag[!event.shiftKey]",
              "update": "tx + event.dx"
            }
          ]
        },
        // 6) íŒ¬(pan)ì„ ìœ„í•œ translate Y
        {
          "name": "ty",
          "value": 275,   // ì´ˆê¸°ê°’: height/2
          "on": [
            {
              "events": "window:drag[!event.shiftKey]",
              "update": "ty + event.dy"
            }
          ]
        }
      ],

      // =====================================================
      // í”„ë¡œì ì…˜: ì‹œê·¸ë„(zoom, tx, ty)ì„ ë°”ì¸ë”©
      // =====================================================
      "projections": [
        {
          "name": "world_projection",
          "type": "equalEarth",
          "scale": { "signal": "zoom" },
          "translate": [
            { "signal": "tx" },
            { "signal": "ty" }
          ]
        }
      ],

      // =====================================================
      // ë°ì´í„°: ì„¸ê³„ ì§€ë„(TopoJSON) + ì§€ì§„ JSON â†’ í•„í„° â†’ geopoint â†’ formula
      // =====================================================
      "data": [
        {
          "name": "world",
          "url": "https://vega.github.io/vega/data/world-110m.json",
          "format": { "type": "topojson", "feature": "countries" }
        },
        {
          "name": "earthquakes",
          "url": "https://raw.githubusercontent.com/Rhamee/Information-Visualization-Final/main/earthquake_data.json",
          "format": { "type": "json" },
          "transform": [
            {
              // 1) ê²€ìƒ‰ì–´/ê·œëª¨/ë‚ ì§œ í•„í„°
              "type": "filter",
              "expr":
                "(searchTerm == '' || indexof(lower(datum.location), lower(searchTerm)) >= 0)" +
                " && (datum.magnitude >= minMag && datum.magnitude <= maxMag)" +
                " && (startDate == '' || datum.date >= startDate)" +
                " && (endDate == '' || datum.date <= endDate)"
            },
            {
              // 2) ìœ„ë„/ê²½ë„ë¥¼ í”„ë¡œì ì…˜ ê²°ê³¼ x/yë¡œ ë³€í™˜
              "type": "geopoint",
              "projection": "world_projection",
              "fields": ["longitude", "latitude"],
              "as": ["x", "y"]
            },
            {
              // 3) ì§€ì§„ ê·œëª¨ â†’ ì›ì˜ ë©´ì (area) ê³„ì‚° (magnitude^4 / 3)
              "type": "formula",
              "expr": "pow(datum.magnitude, 4) / 3",
              "as": "area"
            }
          ]
        }
      ],

      // =====================================================
      // ë§ˆí¬: ìœ¡ì§€(shape) + ì§€ì§„(symbol)
      // =====================================================
      "marks": [
        // (A) ì„¸ê³„ ìœ¡ì§€ ë Œë”ë§
        {
          "type": "shape",
          "from": { "data": "world" },
          "encode": {
            "enter": {
              "fill": { "value": "seagreen" },
              "stroke": { "value": "#666" }
            }
          },
          "transform": [
            { "type": "geoshape", "projection": "world_projection" }
          ]
        },
        // (B) ì§€ì§„ ì •ë³´ ì›í˜• ì‹¬ë³¼ë¡œ í‘œì‹œ
        {
          "type": "symbol",
          "from": { "data": "earthquakes" },
          "encode": {
            "enter": {
              "x": { "field": "x" },
              "y": { "field": "y" },
              "size": { "field": "area" },
              "fill": { "value": "orange" },
              "stroke": { "value": "orange" },
              "strokeWidth": { "value": 1 },
              "opacity": { "value": 0.6 },
              "tooltip": {
                "signal": "'ğŸ“ ' + datum.location + '\\nê·œëª¨: ' + datum.magnitude + ' / ' + datum.date"
              }
            }
          }
        }
      ]
    };

    // =====================================================
    // Vega-Embed: #vis ì—˜ë¦¬ë¨¼íŠ¸ì— spec ë Œë”ë§, ì•¡ì…˜ ë²„íŠ¼ ìˆ¨ê¹€
    // =====================================================
    vegaEmbed('#vis', spec, { actions: false }).then(({ view }) => {
      // ===================================================================
      // (A) HTML ì»¨íŠ¸ë¡¤ê³¼ Vega ì‹œê·¸ë„ì„ ì—°ê²°í•˜ëŠ” ì½”ë“œ
      // ===================================================================
      const searchEl    = document.getElementById('searchTerm');
      const minMagEl    = document.getElementById('minMag');
      const maxMagEl    = document.getElementById('maxMag');
      const startDateEl = document.getElementById('startDate');
      const endDateEl   = document.getElementById('endDate');
      const minValSpan  = document.getElementById('minMagValue');
      const maxValSpan  = document.getElementById('maxMagValue');

      // (A-1) ìœ„ì¹˜ ê²€ìƒ‰ (í…ìŠ¤íŠ¸ ì…ë ¥)
      searchEl.addEventListener('input', () => {
        view.signal('searchTerm', searchEl.value).runAsync();
      });

      // (A-2) ìµœì†Œ ê·œëª¨ ìŠ¬ë¼ì´ë”
      minMagEl.addEventListener('input', () => {
        minValSpan.textContent = minMagEl.value;
        view.signal('minMag', +minMagEl.value).runAsync();
      });

      // (A-3) ìµœëŒ€ ê·œëª¨ ìŠ¬ë¼ì´ë”
      maxMagEl.addEventListener('input', () => {
        maxValSpan.textContent = maxMagEl.value;
        view.signal('maxMag', +maxMagEl.value).runAsync();
      });

      // (A-4) ì‹œì‘ ë‚ ì§œ ì…ë ¥
      startDateEl.addEventListener('input', () => {
        view.signal('startDate', startDateEl.value).runAsync();
      });

      // (A-5) ì¢…ë£Œ ë‚ ì§œ ì…ë ¥
      endDateEl.addEventListener('input', () => {
        view.signal('endDate', endDateEl.value).runAsync();
      });

      // (B) ì¤Œ/íŒ¬ì€ Vega ì‹œê·¸ë„ ì •ì˜ì—ì„œ ì´ë¯¸ window ì´ë²¤íŠ¸ë¥¼ ë°”ì¸ë”©í–ˆìœ¼ë¯€ë¡œ,
      //      ë³„ë„ì˜ HTML ì»¨íŠ¸ë¡¤ì´ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      //      ì‚¬ìš©ìê°€ í™”ë©´ ìœ„ì—ì„œ ë§ˆìš°ìŠ¤ íœ ì„ êµ´ë¦¬ë©´ ìë™ìœ¼ë¡œ 'zoom' ì‹ í˜¸ê°€ ì—…ë°ì´íŠ¸ë˜ê³ ,
      //      ë§ˆìš°ìŠ¤ ë“œë˜ê·¸ë¡œëŠ” 'tx', 'ty' ì‹ í˜¸ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤.
    }).catch(console.error);
  </script>
</body>
</html>
