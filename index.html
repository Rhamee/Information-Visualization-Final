<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì§€ì§„ ë°ì´í„° ì‹œê°í™”</title>
  <!-- Vegaì™€ Vega-Embed ë¶ˆëŸ¬ì˜¤ê¸° -->
  <script src="https://cdn.jsdelivr.net/npm/vega@6"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    /* í™”ë©´ ì „ì²´ë¥¼ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ: ìˆ˜í‰ ì¤‘ì•™ ì •ë ¬ */
    .container {
      display: flex;
      flex-direction: column; /* ì„¸ë¡œë¡œ ìŒ“ê¸° */
      align-items: center;    /* ê°€ë¡œ ë°©í–¥ ê°€ìš´ë° ì •ë ¬ */
      /* ë†’ì´ê°€ ì¶©ë¶„íˆ ìˆìœ¼ë©´, ì„¸ë¡œë¡œë„ ê°€ìš´ë° ì •ë ¬í•˜ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒ ë‘ ì¤„ì„ ì¶”ê°€í•˜ì„¸ìš”:
      justify-content: center;
      height: 100vh;
      */
    }

    /* Vega ì°¨íŠ¸(#vis) ìì²´ë¥¼ ê°€ìš´ë° ì •ë ¬í•˜ê³ , ìƒí•˜ ì—¬ë°±ì„ ì•½ê°„ ì¤ë‹ˆë‹¤. */
    #vis {
      margin: 20px auto;    /* ìœ„ì•„ë˜ 20px, ì¢Œìš° ìë™ ì—¬ë°±(ê°€ìš´ë°) */
      /* í•„ìš”í•˜ë‹¤ë©´ ë„ˆë¹„ë¥¼ ê³ ì •í•˜ê±°ë‚˜ ë°˜ì‘í˜•ìœ¼ë¡œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤. */
      max-width: 900px;
      width: 100%;
      /* ë†’ì´ë„ í•„ìš”í•˜ë‹¤ë©´ ì§€ì • */
      height: 550px;
    }

    /* ì»¨íŠ¸ë¡¤ ì˜ì—­(ê²€ìƒ‰ì°½, ìŠ¬ë¼ì´ë” ë“±)ì„ ì„¸ë¡œë¡œ ì •ë ¬í•˜ë©´ì„œ, ë¶€ë“œëŸ¬ìš´ ë ˆì´ì•„ì›ƒì„ ìœ„í•´ ì•½ê°„ì˜ íŒ¨ë”© ì¶”ê°€ */
    .controls {
      display: flex;
      flex-direction: column;
      align-items: flex-start;  /* ë ˆì´ë¸”+ì…ë ¥ì€ ì™¼ìª½ ì •ë ¬í•´ë„ ë¬´ë°© */
      margin-bottom: 30px;
      gap: 8px; /* ì»¨íŠ¸ë¡¤ ê°„ ê°„ê²© */
      width: 900px; /* Vega ì°¨íŠ¸ì™€ ê°™ì€ ë„ˆë¹„ë¥¼ ì£¼ë©´ ì •ë ¬ê°ì´ ë” ì¢‹ì•„ì§‘ë‹ˆë‹¤ */
      max-width: 100%;
    }

    .controls label {
      font-size: 14px;
      margin-right: 8px;
    }

    .controls input[type="text"] {
      width: 200px;
    }
  </style>
</head>
<body>
  <!-- 1) ëª¨ë“  ë‚´ìš©ì„ ê°ì‹¸ëŠ” ì»¨í…Œì´ë„ˆ -->
  <div class="container">
    <!-- 2) Vega ì‹œê°í™”ê°€ í‘œì‹œë  ì˜ì—­ -->
    <div id="vis"></div>

    <!-- 3) ì•„ë˜ì— ê²€ìƒ‰/ìŠ¬ë¼ì´ë”/ë‚ ì§œ ì…ë ¥ ë“±ì˜ ì»¨íŠ¸ë¡¤ -->
    <div class="controls">
      <!-- ìœ„ì¹˜ ê²€ìƒ‰ -->
      <label for="searchTerm">ìœ„ì¹˜ ê²€ìƒ‰ (ì˜ˆ: ì¼ë³¸):</label>
      <input type="text" id="searchTerm" name="searchTerm" />

      <!-- ìµœì†Œ ê·œëª¨ ìŠ¬ë¼ì´ë” -->
      <label for="minMag">ìµœì†Œ ê·œëª¨:</label>
      <input type="range" id="minMag" name="minMag" min="0" max="10" step="0.1" value="0" />

      <!-- ìµœëŒ€ ê·œëª¨ ìŠ¬ë¼ì´ë” -->
      <label for="maxMag">ìµœëŒ€ ê·œëª¨:</label>
      <input type="range" id="maxMag" name="maxMag" min="0" max="10" step="0.1" value="10" />

      <!-- ì‹œì‘ ë‚ ì§œ -->
      <label for="startDate">ì‹œì‘ ë‚ ì§œ:</label>
      <input type="date" id="startDate" name="startDate" />

      <!-- ì¢…ë£Œ ë‚ ì§œ -->
      <label for="endDate">ì¢…ë£Œ ë‚ ì§œ:</label>
      <input type="date" id="endDate" name="endDate" />
    </div>
  </div>

  <script>
    // Vega ì‚¬ì–‘(spec)
    const spec = {
      "$schema": "https://vega.github.io/schema/vega/v6.json",
      "width": 900,
      "height": 550,
      "padding": 5,
      "background": "steelblue",

      "signals": [
        {
          "name": "searchTerm",
          "value": "",
          "on": [
            {
              "events": { "input": "searchTerm" },
              "update": "searchTerm"
            }
          ]
        },
        {
          "name": "minMag",
          "value": 0,
          "on": [
            {
              "events": { "input": "minMag" },
              "update": "minMag"
            }
          ]
        },
        {
          "name": "maxMag",
          "value": 10,
          "on": [
            {
              "events": { "input": "maxMag" },
              "update": "maxMag"
            }
          ]
        },
        {
          "name": "startDate",
          "value": "",
          "on": [
            {
              "events": { "input": "startDate" },
              "update": "startDate"
            }
          ]
        },
        {
          "name": "endDate",
          "value": "",
          "on": [
            {
              "events": { "input": "endDate" },
              "update": "endDate"
            }
          ]
        }
      ],

      "projections": [
        {
          "name": "world_projection",
          "type": "equalEarth",
          "scale": 180,
          "translate": [
            { "signal": "width / 2" },
            { "signal": "height / 2" }
          ]
        }
      ],

      "data": [
        {
          "name": "world",
          "url": "https://vega.github.io/vega/data/world-110m.json",
          "format": { "type": "topojson", "feature": "countries" }
        },
        {
          "name": "earthquakes",
          "url": "https://raw.githubusercontent.com/Rhamee/Information-Visualization-Final/main/earthquake_data.json",
          "format": { "type": "json" },
          "transform": [
            {
              "type": "filter",
              "expr":
                "(searchTerm == '' || indexof(lower(datum.location), lower(searchTerm)) >= 0)" +
                " && (datum.magnitude >= minMag && datum.magnitude <= maxMag)" +
                " && (startDate == '' || datum.date >= startDate)" +
                " && (endDate == '' || datum.date <= endDate)"
            },
            {
              "type": "geopoint",
              "projection": "world_projection",
              "fields": ["longitude", "latitude"],
              "as": ["x", "y"]
            },
            {
              "type": "formula",
              "expr": "pow(datum.magnitude, 3.5)",
              "as": "area"
            }
          ]
        }
      ],

      "marks": [
        {
          "type": "shape",
          "from": { "data": "world" },
          "encode": {
            "enter": {
              "fill": { "value": "seagreen" },
              "stroke": { "value": "#666" }
            }
          },
          "transform": [
            {
              "type": "geoshape",
              "projection": "world_projection"
            }
          ]
        },
        {
          "type": "symbol",
          "from": { "data": "earthquakes" },
          "encode": {
            "enter": {
              "x": { "field": "x" },
              "y": { "field": "y" },
              "size": { "field": "area" },
              "fill": { "value": "orange" },
              "stroke": { "value": "orange" },
              "strokeWidth": { "value": 1 },
              "opacity": { "value": 0.6 },
              "tooltip": {
                "signal": "'ğŸ“ ' + datum.location + '\\nê·œëª¨: ' + datum.magnitude + ' / ' + datum.date"
              }
            }
          }
        }
      ]
    };

    // Vega-Embed ì˜µì…˜: signalsë¥¼ HTML ì»¨íŠ¸ë¡¤ê³¼ ì—°ê²°í•˜ë ¤ë©´, vega-embed ì„¤ì •ì„ ì¶”ê°€
    const embedOptions = {
      // Vega-EmbedëŠ” HTML ì»¨íŠ¸ë¡¤( id="searchTerm" ë“± )ì„ Vega ì‹œê·¸ë„ì— ìë™ ì—°ê²°í•´ ì£¼ì§€ëŠ” ì•ŠìŠµë‹ˆë‹¤.
      // ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´, Vega Viewë¥¼ ì–»ì€ ë’¤ì— HTML ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸ë¥¼ ì§ì ‘ ì—°ê²°í•´ ì¤ë‹ˆë‹¤.
      actions: false
    };

    vegaEmbed('#vis', spec, embedOptions).then(({ view }) => {
      // HTML ì»¨íŠ¸ë¡¤ì˜ ë³€í™” â†’ Vega ì‹œê·¸ë„ ì—…ë°ì´íŠ¸
      document.getElementById('searchTerm').addEventListener('input', function() {
        view.signal('searchTerm', this.value).runAsync();
      });
      document.getElementById('minMag').addEventListener('input', function() {
        view.signal('minMag', +this.value).runAsync();
      });
      document.getElementById('maxMag').addEventListener('input', function() {
        view.signal('maxMag', +this.value).runAsync();
      });
      document.getElementById('startDate').addEventListener('input', function() {
        view.signal('startDate', this.value).runAsync();
      });
      document.getElementById('endDate').addEventListener('input', function() {
        view.signal('endDate', this.value).runAsync();
      });
    });
  </script>
</body>
</html>
