<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì§€ì§„ ë°ì´í„° ì‹œê°í™” (í™•ëŒ€ ê¸°ëŠ¥ ì¶”ê°€)</title>

  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <style>
    /* (1) body ì „ì²´ë¥¼ Flex ì»¨í…Œì´ë„ˆë¡œ ë§Œë“¤ê³ ,
         í™”ë©´ ì„¸ë¡œ ì¤‘ì•™ ì •ë ¬ì€ í•„ìš” ì—†ë‹¤ë©´ justify-contentë¥¼ ì§€ì›Œë„ ë©ë‹ˆë‹¤. */
    html, body {
      margin: 0;
      padding: 0;
      background-color: #eef2f5;
      display: flex;
      flex-direction: column;
      align-items: center;     /* ê°€ë¡œ ë°©í–¥ ì¤‘ì•™ ì •ë ¬ */
      /* justify-content: center; */ /* ì„¸ë¡œ ë°©í–¥ ì¤‘ì•™ ì •ë ¬ì´ í•„ìš”í•˜ë‹¤ë©´ ì£¼ì„ í•´ì œ */
    }

    /* (2) ì§€ë„ì™€ ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ë¥¼ ë¬¶ëŠ” ë˜í¼(wrapper) */
    .wrapper {
      width: 900px;         /* ì§€ë„ì˜ widthì™€ ë™ì¼í•˜ê²Œ ë§ì¶¤ */
      margin: 20px auto;      /* í™”ë©´ ìƒí•˜ ì—¬ë°± 20px, ì¢Œìš° ìë™ ë§ˆì§„(ê°€ìš´ë° ë°°ì¹˜) */
      display: flex;
      flex-direction: column; /* ìœ„ì— ë†’ì´ê°€ ìˆëŠ” ì§€ë„, ì•„ë˜ì— ì»¨íŠ¸ë¡¤ ë°•ìŠ¤ */
      align-items: stretch;   /* ìì‹ ìš”ì†Œ(#vis, .controls)ê°€ ë„ˆë¹„ 100%ë¡œ ëŠ˜ì–´ë‚˜ë„ë¡ */
      gap: 0;                 /* í•„ìš” ì‹œ í•˜ë‹¨ ì—¬ë°±ì„ ì¡°ì •í•˜ë˜, ì—¬ê¸°ì„œëŠ” 0 */
    }

    /* (3) Vega ì‹œê°í™” ì˜ì—­(#vis) */
    #vis {
      width: 100%;            /* ë˜í¼ ë„ˆë¹„(900px)ì— ë§ì¶° 100% */
      height: 550px;          /* ì§€ë„ ë†’ì´ ê³ ì • */
      background: white;      /* ì•½ê°„ì˜ í°ìƒ‰ ë°°ê²½ */
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
    }

    /* (4) ì»¨íŠ¸ë¡¤ ë°•ìŠ¤(.controls) ìŠ¤íƒ€ì¼ */
    .controls {
      width: 100%;            /* ë˜í¼ ë„ˆë¹„(900px)ì— ë”± ë§ì¶¤ */
      background: white;
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      padding: 12px 16px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-radius: 4px;
      margin-top: 16px;       /* ì§€ë„ì™€ ì»¨íŠ¸ë¡¤ ì‚¬ì´ ì•½ê°„ì˜ ì—¬ë°± */
    }

    .controls > div {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .controls label {
      font-size: 14px;
      white-space: nowrap;
    }

    .controls input[type="text"] {
      width: 180px;
      padding: 4px 6px;
      font-size: 14px;
    }

    .controls input[type="range"] {
      width: 150px;
    }

    .controls input[type="date"] {
      padding: 4px;
      font-size: 14px;
    }

    .controls span {
      font-size: 14px;
      min-width: 24px;
      text-align: center;
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <div id="vis"></div>

    <div class="controls">
      <div>
        <label for="searchTerm">ìœ„ì¹˜ ê²€ìƒ‰</label>
        <input type="text" id="searchTerm" placeholder="ì˜ˆ: ì¼ë³¸ (ì…ë ¥ í›„ ì ì‹œ ëŒ€ê¸°)" />
      </div>
      <div>
        <label for="minMag">ìµœì†Œ ê·œëª¨</label>
        <input type="range" id="minMag" min="0" max="10" step="0.1" value="0" />
        <span id="minMagValue">0</span>
      </div>
      <div>
        <label for="maxMag">ìµœëŒ€ ê·œëª¨</label>
        <input type="range" id="maxMag" min="0" max="10" step="0.1" value="10" />
        <span id="maxMagValue">10</span>
      </div>
      <div>
        <label for="startDate">ì‹œì‘ ë‚ ì§œ</label>
        <input type="date" id="startDate" />
      </div>
      <div>
        <label for="endDate">ì¢…ë£Œ ë‚ ì§œ</label>
        <input type="date" id="endDate" />
      </div>
    </div>
  </div>

  <script>
    // Vega ì‚¬ì–‘(spec)
    const spec = {
      "$schema": "https://vega.github.io/schema/vega/v5.json",
      "width": 900,
      "height": 550,
      "padding": 5,
      "background": "steelblue",

      "signals": [
        // --- ê¸°ì¡´ í•„í„°ë§ ì‹ í˜¸ë“¤ ---
        {
          "name": "searchTerm", "value": "",
          "on": [{"events": "input#searchTerm", "update": "event.target.value"}]
        },
        {
          "name": "minMag", "value": 0,
          "bind": {"input": "range", "element": "#minMag", "min": 0, "max": 10, "step": 0.1}
        },
        {
          "name": "maxMag", "value": 10,
          "bind": {"input": "range", "element": "#maxMag", "min": 0, "max": 10, "step": 0.1}
        },
        {
          "name": "startDate", "value": "",
          "on": [{"events": "input#startDate", "update": "event.target.value"}]
        },
        {
          "name": "endDate", "value": "",
          "on": [{"events": "input#endDate", "update": "event.target.value"}]
        },

        // --- âœ¨ í™•ëŒ€/ì´ë™ì„ ìœ„í•œ ì‹ í˜¸ ì¶”ê°€ ---
        {
          "name": "centerPoint",
          "value": [0, 0],
          "on": [{
            "events": {"signal": "searchTerm"},
            "update": "searchTerm ? (data('earthquakes')[0] ? [data('earthquakes')[0].longitude, data('earthquakes')[0].latitude] : [0,0]) : [0,0]"
          }]
        },
        {
          "name": "scale",
          "value": 180,
          "on": [{
            "events": {"signal": "searchTerm"},
            "update": "searchTerm ? 1000 : 180"
          }]
        }
      ],

      // --- âœ¨ í”„ë¡œì ì…˜(íˆ¬ì˜ë²•)ì— ì‹ í˜¸ë¥¼ ì—°ê²°í•˜ì—¬ ë™ì ìœ¼ë¡œ ë³€ê²½ ---
      "projections": [
        {
          "name": "world_projection",
          "type": "equalEarth",
          "scale": {"signal": "scale"},
          "rotate": {"signal": "[-(centerPoint[0] || 0), -(centerPoint[1] || 0), 0]"},
          "translate": [
            {"signal": "width / 2"},
            {"signal": "height / 2"}
          ]
        }
      ],

      "data": [
        {
          "name": "world",
          "url": "https://vega.github.io/vega/data/world-110m.json",
          "format": { "type": "topojson", "feature": "countries" }
        },
        {
          "name": "earthquakes",
          "url": "https://raw.githubusercontent.com/Rhamee/Information-Visualization-Final/main/earthquake_data.json",
          "format": { "type": "json" },
          "transform": [
            {
              "type": "filter",
              "expr":
                "(searchTerm == '' || indexof(lower(datum.location), lower(searchTerm)) >= 0)" +
                " && (datum.magnitude >= minMag && datum.magnitude <= maxMag)" +
                " && (startDate == '' || datum.date >= startDate)" +
                " && (endDate == '' || datum.date <= endDate)"
            },
            {
              "type": "geopoint",
              "projection": "world_projection",
              "fields": ["longitude", "latitude"],
              "as": ["x", "y"]
            },
            {
              "type": "formula",
              "expr": "pow(datum.magnitude, 3.5)",
              "as": "area"
            }
          ]
        }
      ],

      "marks": [
        {
          "type": "shape",
          "from": { "data": "world" },
          "encode": {
            "enter": {
              "fill": { "value": "seagreen" },
              "stroke": { "value": "#666" }
            }
          },
          "transform": [
            { "type": "geoshape", "projection": "world_projection" }
          ]
        },
        {
          "type": "symbol",
          "from": { "data": "earthquakes" },
          "encode": {
            "enter": {
              "x": { "field": "x" },
              "y": { "field": "y" },
              "size": { "field": "area" },
              "fill": { "value": "orange" },
              "stroke": { "value": "orange" },
              "strokeWidth": { "value": 1 },
              "opacity": { "value": 0.6 },
              "tooltip": {
                "signal": "'ğŸ“ ' + datum.location + '\\nê·œëª¨: ' + datum.magnitude + ' / ' + datum.date"
              }
            }
          }
        }
      ]
    };

    // Vega-Embed: #visì— specì„ ë Œë”ë§, actions ì˜µì…˜ì„ êº¼ì„œ Vega ë¡œê³ /ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ì„ ìˆ¨ê¹ë‹ˆë‹¤.
    vegaEmbed('#vis', spec, { actions: false }).then(({ view }) => {
      // HTML ì»¨íŠ¸ë¡¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ (Vegaì˜ 'bind'ë¡œ ëŒ€ì²´ë˜ì–´ ëŒ€ë¶€ë¶„ í•„ìš” ì—†ì–´ì§)
      // ìŠ¬ë¼ì´ë” ê°’ í‘œì‹œë¥¼ ìœ„í•œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆëŠ” ë‚¨ê²¨ë‘¡ë‹ˆë‹¤.
      const minMagEl   = document.getElementById('minMag');
      const maxMagEl   = document.getElementById('maxMag');
      const minValSpan = document.getElementById('minMagValue');
      const maxValSpan = document.getElementById('maxMagValue');
      const searchTermEl = document.getElementById('searchTerm');
      const startDateEl = document.getElementById('startDate');
      const endDateEl = document.getElementById('endDate');

      minMagEl.addEventListener('input', () => minValSpan.textContent = minMagEl.value);
      maxMagEl.addEventListener('input', () => maxValSpan.textContent = maxMagEl.value);
      
      // Vega Spec ì™¸ë¶€ì—ì„œ ì‹œê·¸ë„ì„ ì§ì ‘ ì—…ë°ì´íŠ¸í•˜ëŠ” ë¡œì§ì€ 'bind'ì™€ 'on'ìœ¼ë¡œ ëŒ€ì²´ë˜ì—ˆìœ¼ë¯€ë¡œ ì œê±°í•©ë‹ˆë‹¤.
    });
  </script>
</body>
</html>
